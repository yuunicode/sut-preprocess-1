# 성능 향상/튜닝 포인트 정리

## 헤딩 보정
- `headings.log`를 참고해 실제로 헤딩으로 파싱된 마크다운을 확인하고, 잘못 끊긴 헤딩은 원문(`*_rule_sanitized.md`)을 수정해 재실행해 볼 수 있습니다.
- 헤딩 구조가 안정되면 이후 청킹/플레이스홀더 정합성이 올라갑니다.

## Sanitize 변환 내용 리마인드
- `*_rule_sanitized.md`: 수식/헤딩 정규화 결과. HTML 수식 태그/헤더 레벨을 정리합니다.
- `*_placeholders.md`: 테이블/이미지에 플레이스홀더 삽입, `components.json` 기록.
- `*_cleaned.md`: `<p><br>` 제거, `<ol>/<ul>`을 텍스트 리스트로 변환, “끝/이하여백/뒷장계속” 등 노이즈 라인 제거.
- 위 정리 과정에서 바꾼 내용(정규식/HTML 정리 등)을 이해한 뒤 필요하면 규칙을 조정하고 재실행하세요.

## LLM 페이로드 커스터마이즈
- `core/llm/llm_payloads.py` 생성 단계에서 원하는 입력 필드를 추가할 수 있으며, 그에 맞춰 프롬프트도 수정해야 합니다.
- `context_before/context_after`는 기본으로 `_cleaned.md`에서 15토큰씩 추출해 넣었지만, 길이·소스·필드를 자유롭게 바꿔도 됩니다.
- 프롬프트/입력 조합을 바꾸면 `_payload.json`을 다시 생성한 후 `run_llm_payloads.py`를 실행하세요.

## 검색/생성 튜닝 포인트
- 현재 Qdrant 적재는 dense 임베딩만 사용합니다. 필요하면 sparse/다른 벡터를 추가로 적재하도록 확장할 수 있습니다.
- 생성 시 placeholder(`{{ID}}`)가 있으면 해당 ID의 벡터 텍스트를 추가 컨텍스트로 붙입니다. 이 동작(해석 방식/매칭 로직)도 상황에 맞게 변경 가능하니 팀 요구에 따라 조정하세요.

## 복잡 테이블/이미지 검토
- 예: `TP-030-030-100`처럼 복잡한 테이블·이미지는 자동 파싱 정확도가 낮을 수 있습니다. 실제로 중요한지 여부를 포스코 담당자와 논의하고, 필요 시 수동 보정/제외 정책을 세우는 것이 좋습니다.
